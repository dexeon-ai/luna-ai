ğŸ§  LUNA AI â€” Handoff Update (v2025-10-28)
ğŸŒ• Core Summary

Luna AI is Dexeonâ€™s real-time crypto analysis engine and streaming character.
She powers the Luna Cockpit Control Panel, a live Flask-based dashboard that merges technical indicators, sentiment signals, and AI narrative analysis for any token or contract.
Her â€œvoiceâ€ and logic are unified across the interactive cockpit, the animated streaming series, and the upcoming LUNA meme coin ecosystem.

This build replaces the previous backend and front-end logic with real-time market integration, better data slicing, and full TF-aware chart control â€” without altering the established design or structure.

ğŸ”§ Current System Version â€” v2.7 â€œCandlelightâ€

Deployment Date: 2025-10-28
Framework: Flask (Python 3.11)
Frontend Stack: Plotly.js + vanilla JS + Tailwind CSS variables
Data Cache: local parquet (per symbol)
TTL Refresh: 15-minute adaptive
Active APIs:

CryptoCompare (primary minute/hour/day OHLCV)

CoinGecko (fallback + contract hydration)

Optional: Bitquery, Helius, Covalent (for future Whale metrics)

OpenAI / ElevenLabs (AI narrative + voice)

ğŸ§© Folder Layout
Luna AI/
 â”œâ”€â”€ server.py                   # Flask app + all endpoints + data logic
 â”œâ”€â”€ .env                        # API keys + refresh settings
 â”œâ”€â”€ /templates/control_panel.html
 â”œâ”€â”€ /static/css/control_panel.css
 â”œâ”€â”€ /static/js/control_panel.js
 â”œâ”€â”€ /luna_cache/
 â”‚     â”œâ”€â”€ /data/
 â”‚     â”‚     â”œâ”€â”€ /derived/frames/*.parquet     # Per-symbol OHLCV cache
 â”‚     â”‚     â”œâ”€â”€ /analysis/*.json              # Optional saved narratives
 â”‚     â”‚     â”œâ”€â”€ /state/fetch_log.json         # TTL timestamps
 â”‚     â”‚     â””â”€â”€ /sessions/*.json              # Ask-Luna chat logs (21 Q limit)
 â”‚     â””â”€â”€ /img/cockpit_bg.png
 â”œâ”€â”€ lunahandoff.txt             # This document (project continuity)
 â””â”€â”€ requirements.txt            # pandas, plotly, flask, requests, python-dotenv

ğŸ›°ï¸ System Architecture
Data Sources & Refresh Logic

CryptoCompare is the live feed for minute/hour/day OHLCV.

Pulls last 6 hours (minute), last 30 days (hour), and 6 months (daily).

Combines + deduplicates + persists to /frames/SYMBOL.parquet.

15-minute TTL: refreshes every quarter hour or by manual â€œRefresh ğŸ”â€.

CoinGecko used only when symbol not found or contract hydration required.

/coins/{id}/market_chart via API key in .env.

Handles free-tier rate limits with progressive fallbacks (365 â†’ 30 days).

Future integrations (not yet active but stubbed in):

Whale data (Helius / Bitquery)

On-chain liquidity signals

Sentiment (Twitter / LunarCrush API)

ğŸ“Š Dashboard Functionality
1ï¸âƒ£ Default View

Opens at /analyze?symbol=BTC&tf=4h (last 4 hours).

11 timeframe chips at top (1h â†’ all).

Default slicing: _slice_tf(df, "4h") ensures main + tiles show the same window.

2ï¸âƒ£ Global Controls

Height slider: CSS variable --tileH, affects only tile height visually.

Search: Accepts symbols (BTC) or contract addresses (0xâ€¦).

Contracts hydrate via CoinGecko â†’ cache as <SYMBOL>.parquet.

Refresh: manual API call /api/refresh/<symbol>.

3ï¸âƒ£ Timeframe Behavior

Clicking a timeframe chip reloads the page with ?tf=<selected> so all charts update consistently.

Modals sync to global TF via â€œLink TFâ€ toggle.

4ï¸âƒ£ Data Tiles

10 technical indicators:

RSI, MACD, Liquidity, Sentiment (24h), Volume Trend, OBV, ADX, Market Cap, Bands, Bollinger Width.

1 main candlestick chart with BB overlays.

1 Trending (Top Â±) tile.

Investment Chips: show what a $1000 investment would have done for each TF.

5ï¸âƒ£ Modals

Expand buttons open Plotly charts with full controls:

TF toggle (1h â†’ all)

Copy JSON / Save PNG / Autoscale

Side panel: blurb + key stats + interpretation bullets

Modal charts dynamically reload from /expand_json.

6ï¸âƒ£ Ask Luna

Local session (21-question limit).

Responses generated from _compose_luna_paragraph() + the last user prompt.

Personality: â€œCute, witty, confidentâ€ â€” data-driven yet conversational.

Persists session JSON in /luna_cache/data/sessions/.

ğŸ§® Lunaâ€™s Intelligence Layer
Analysis Model

Derived from technical indicators:

RSI â†’ momentum tone

MACD â†’ crossover signal & histogram bias

ADX â†’ trend strength (firm/strong/weak)

BB width â†’ volatility compression or expansion

StochRSI â†’ directional bias

OBV â†’ accumulation vs distribution

Each metric contributes to a score system â†’ TL;DR sentiment:

â‰¥ +2.0 â†’ Bullish

â‰¥ +1.25 â†’ Modestly Bullish

0 Â± 1 â†’ Neutral / Sideways

â‰¤ âˆ’1.25 â†’ Modestly Bearish

â‰¤ âˆ’2.0 â†’ Bearish

Personality overlay: â€œbalanced but bouncy,â€ â€œif price pops, Iâ€™ll cheer; if it fizzles, Iâ€™ll side-eye it.â€

ğŸŒˆ Visual Logic (unchanged)

6x2 grid layout: 10 mini tiles + 1 central candlestick + 1 trending tile.

Background: cockpit_bg.png (control deck aesthetic).

Color codes:

Green (#19e28c) â†’ Uptrend

Red (#ff6b7a) â†’ Downtrend

Purple (#7b62f0) â†’ Bands

Cyan (#00e5a8) â†’ Liquidity

ğŸ”Œ API Endpoints Summary
Endpoint	Purpose	Returns
/analyze?symbol=BTC&tf=4h	Main view	Full HTML render
/api/refresh/BTC	Force new data	{status:"refreshed"}
/api/trending?tf=4h	Gainers/losers	JSON array
/api/search?q=btc	Symbol/contract search	JSON list
/expand_json?symbol=BTC&key=RSI&tf=4h	Modal chart data	Plotly JSON
/api/luna	Ask-Luna AI	JSON reply / session info
ğŸ’¾ Data Files

BTC.parquet: combined OHLCV from CryptoCompare (minute+hour+day).

fetch_log.json: timestamp of last TTL refresh per symbol.

sessions/*.json: per-user 21-Q logs.

analysis/*.json: future manual narratives.

ğŸª™ Ecosystem Integration
Branch	Purpose
LUNA Meme Coin	Session access token; later staking for premium analytics.
Pump.fun Series	Animated shorts featuring Luna explaining market trends.
NFT Collection	Ownership = priority API access + free session credits.
Virtuals Protocol Clone	Dexeonâ€™s Virtual Agent version for tokenized co-ownership.
Voice Layer	ElevenLabs voice generation using Lunaâ€™s narrative output.
ğŸš€ Launch Readiness (Fed Drop Edition)

âœ… Minute + Hour integration (real intraday data)
âœ… Default 4h slice
âœ… Timeframe sync across all charts
âœ… Live trending recalculation
âœ… Lunaâ€™s personality narrative
âœ… Investment calculator accuracy
âœ… Front-end refresh flow (TF â†’ URL reload)

Remaining

Market Cap smoothing â€” fallback to CoinGecko if CC data missing

Sentiment data source â€” connect LunarCrush or X feed

Whale metrics â€” integrate Helius / Bitquery

Voice playback â€” ElevenLabs link

Wallet + LUNA token gating â€” enable in /api/luna

Public streaming mode â€” OBS/Restream integration for Lunaâ€™s video overlay

ğŸ§­ Immediate Next Steps

Test /analyze?symbol=BTC&tf=4h â€” verify chart time axis uses current dayâ€™s UTC timestamps.

Run manual /api/refresh/BTC to pull minute data on-demand.

Validate indicator overlays (RSI, MACD, BB, ADX) match Dexscreener data.

Stress-test trending tile on top 10 coins.

Voice synthesis of analysis["luna_paragraph"] via ElevenLabs.

Prepare content sync for tomorrowâ€™s Fed rate decision broadcast (OBS scene = cockpit background + Luna voice + charts).

ğŸ§  Dexeon Context

Parent Entity: Dexeon.ai â€” AI product company building tokenized intelligence agents.
Projects:

Luna AI: Crypto cockpit + streaming personality.

Bankroll AI: Sports betting intelligence / $BKRL token.

Emerald Brook Forest: Animated IP for family audiences.

Virtuals Integration: Dexeon deploying agents (Luna, Bankroll, etc.) as on-chain co-owned entities.

ğŸ”’ Keys & Security Reminder

Keep .env private.
Each API batch should be rotated manually monthly to avoid 401s.
Ensure Git excludes .env, /luna_cache/data/, and /sessions/.

ğŸ“¦ Current Version Deliverables

âœ… Full server.py (merged minute/hour/day feeds)

âœ… Full control_panel.js (TF-aware reload + modal sync)

âœ… Updated .env (multi-key CC rotation + CG fallback)

âœ… Verified control_panel.css untouched layout

âœ… Handoff documentation (this file)

ğŸ”š Summary

Luna AIâ€™s cockpit is now production-grade for live use â€” real-time, TF-aware, and visually stable.
She speaks in plain English, narrates with personality, and reacts to live intraday data.
The next iteration will add wallet gating, NFTs, and Virtuals deployment â€” but this version can already broadcast the Fed reaction live with Luna narrating real charts.

Version Tag: LUNA-Cockpit-v2.7-Candlelight
Timestamp: 2025-10-28T23:59Z
Maintainers: Dexeon AI Core / Jason Pate / Steve Taylor

âœ… End of handoff â€” ready for next-session import.